<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî Nexus Dark</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 class="rainbow-text-small">Nexus Dark</h1>
    <div class="top-right-controls">
        <a href="market.html" class="button" title="–ì–ª–∞–≤–Ω–∞—è"><span style="font-size:1.3em;">üè†</span></a>
        <a href="profile.html" class="button" title="–ü—Ä–æ—Ñ–∏–ª—å"><span style="font-size:1.3em;">üë§</span></a>
        <a href="users.html" class="button" title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" id="adminNav" style="display:none;"><span style="font-size:1.3em;">üõ°Ô∏è</span></a>
        <a href="cart.html" class="button" title="–ö–æ—Ä–∑–∏–Ω–∞"><span style="font-size:1.3em;">üõí</span></a>
    </div>
    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        if (currentUser.role === 'admin' || currentUser.email === 'admin@nexusdark.ru') {
            const el = document.getElementById('adminNav'); if (el) el.style.display = '';
        }
    </script>
    <main class="auth-center">
        <div class="auth-card product-card">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input id="email" type="email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞" style="margin-bottom:10px;">
            <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" style="margin-bottom:10px;">
            <input id="password2" type="password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="margin-bottom:10px;">
            <div class="auth-actions" style="margin-top:10px; display:flex; justify-content:center; gap:8px;">
                <button id="registerBtn" class="button">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <a href="login.html" class="button">–í–æ–π—Ç–∏</a>
            </div>
            <div id="regMsg" style="margin-top:8px;color:#eee; text-align:center;"></div>
        </div>
    </main>

    <script>
        document.getElementById('registerBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const password2 = document.getElementById('password2').value;
            if (!email || !password) { document.getElementById('regMsg').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; return; }
            if (password !== password2) { document.getElementById('regMsg').textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'; return; }
            try {
                const res = await fetch('http://localhost:8000/register', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: email.split('@')[0], email, password })
                });
                if (!res.ok) {
                    const err = await res.json().catch(()=>({detail:'–û—à–∏–±–∫–∞'}));
                    document.getElementById('regMsg').textContent = err.detail || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
                    return;
                }
                const data = await res.json();
                document.getElementById('regMsg').textContent = '–ì–æ—Ç–æ–≤–æ';
                // navigate to login
                setTimeout(() => location.href = 'login.html', 800);
            } catch(e) {
                document.getElementById('regMsg').textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
            }
        });
    </script>
</body>
</html>