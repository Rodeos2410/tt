<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ ‚Äî Nexus Dark</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1 class="rainbow-text-small">Nexus Dark</h1>
    <div class="top-right-controls">
        <a href="market.html" class="button" title="–ì–ª–∞–≤–Ω–∞—è"><span style="font-size:1.3em;">üè†</span></a>
        <a href="profile.html" class="button" title="–ü—Ä–æ—Ñ–∏–ª—å"><span style="font-size:1.3em;">üë§</span></a>
        <a href="users.html" class="button" title="–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" id="adminNav" style="display:none;"><span style="font-size:1.3em;">üõ°Ô∏è</span></a>
        <a href="cart.html" class="button" title="–ö–æ—Ä–∑–∏–Ω–∞"><span style="font-size:1.3em;">üõí</span></a>
    </div>
    <script>
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        if (currentUser.role === 'admin' || currentUser.email === 'admin@nexusdark.ru') {
            const el = document.getElementById('adminNav'); if (el) el.style.display = '';
        }
    </script>
    <main class="auth-center">
        <div class="auth-card product-card">
            <h2>–í—Ö–æ–¥</h2>
            <input id="email" type="email" placeholder="–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞" style="margin-bottom:10px;">
            <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å" style="margin-bottom:10px;">
            <div style="margin-top:10px; display:flex; justify-content:center; gap:8px;">
                <button id="loginBtn" class="button">–í–æ–π—Ç–∏</button>
                <a href="register.html" class="button">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
            <div id="loginMsg" style="margin-top:8px;color:#eee; text-align:center;"></div>
        </div>
    </main>

    <script>
        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            if (!email || !password) { document.getElementById('loginMsg').textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'; return; }
            try {
                const res = await fetch('http://localhost:8000/login', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                if (!res.ok) {
                    const err = await res.json().catch(()=>({detail:'–û—à–∏–±–∫–∞'}));
                    document.getElementById('loginMsg').textContent = err.detail || '–ù–µ–≤–µ—Ä–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
                    return;
                }
                const data = await res.json();
                localStorage.setItem('authToken', data.access_token);
                localStorage.setItem('currentUser', JSON.stringify({ email }));
                // if admin email -> go to users page
                if (email === 'admin@nexusdark.ru') { location.href = 'users.html'; } else { location.href = 'market.html'; }
            } catch (e) {
                document.getElementById('loginMsg').textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º';
            }
        });
    </script>
</body>
</html>